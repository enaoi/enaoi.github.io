<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Getting Start With Redux | enaoi&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="vue、react、webpack...，everything about front development.">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="preload" href="/assets/css/0.styles.13931c1a.css" as="style"><link rel="preload" href="/assets/js/app.8a6f8a64.js" as="script"><link rel="preload" href="/assets/js/2.842e7985.js" as="script"><link rel="preload" href="/assets/js/67.30c535e8.js" as="script"><link rel="prefetch" href="/assets/js/10.cdb683af.js"><link rel="prefetch" href="/assets/js/11.320018ad.js"><link rel="prefetch" href="/assets/js/12.1575a701.js"><link rel="prefetch" href="/assets/js/13.d710e265.js"><link rel="prefetch" href="/assets/js/14.5a9138af.js"><link rel="prefetch" href="/assets/js/15.ad37ab1d.js"><link rel="prefetch" href="/assets/js/16.a7543076.js"><link rel="prefetch" href="/assets/js/17.55938c7a.js"><link rel="prefetch" href="/assets/js/18.b267eae3.js"><link rel="prefetch" href="/assets/js/19.e7ee1e66.js"><link rel="prefetch" href="/assets/js/20.869f7f33.js"><link rel="prefetch" href="/assets/js/21.189e2b24.js"><link rel="prefetch" href="/assets/js/22.4bf5bbb5.js"><link rel="prefetch" href="/assets/js/23.460d48ca.js"><link rel="prefetch" href="/assets/js/24.3bc81cd6.js"><link rel="prefetch" href="/assets/js/25.2b74f289.js"><link rel="prefetch" href="/assets/js/26.ad5a6f1e.js"><link rel="prefetch" href="/assets/js/27.060760e2.js"><link rel="prefetch" href="/assets/js/28.b8e2c39d.js"><link rel="prefetch" href="/assets/js/29.41256001.js"><link rel="prefetch" href="/assets/js/3.446337b8.js"><link rel="prefetch" href="/assets/js/30.f5cd6965.js"><link rel="prefetch" href="/assets/js/31.5febacb9.js"><link rel="prefetch" href="/assets/js/32.ed0a19fa.js"><link rel="prefetch" href="/assets/js/33.67be766e.js"><link rel="prefetch" href="/assets/js/34.2920acfb.js"><link rel="prefetch" href="/assets/js/35.3cb84bf2.js"><link rel="prefetch" href="/assets/js/36.6cf685fd.js"><link rel="prefetch" href="/assets/js/37.ba196ca1.js"><link rel="prefetch" href="/assets/js/38.b3487aa2.js"><link rel="prefetch" href="/assets/js/39.8059deed.js"><link rel="prefetch" href="/assets/js/4.f5601869.js"><link rel="prefetch" href="/assets/js/40.84387762.js"><link rel="prefetch" href="/assets/js/41.e1739030.js"><link rel="prefetch" href="/assets/js/42.ecf48b28.js"><link rel="prefetch" href="/assets/js/43.dc47cb80.js"><link rel="prefetch" href="/assets/js/44.ca1f2934.js"><link rel="prefetch" href="/assets/js/45.ef1585b2.js"><link rel="prefetch" href="/assets/js/46.f4704de7.js"><link rel="prefetch" href="/assets/js/47.a5aa7a82.js"><link rel="prefetch" href="/assets/js/48.2f596373.js"><link rel="prefetch" href="/assets/js/49.2649e461.js"><link rel="prefetch" href="/assets/js/5.e8366d7d.js"><link rel="prefetch" href="/assets/js/50.f6e56838.js"><link rel="prefetch" href="/assets/js/51.443b2b38.js"><link rel="prefetch" href="/assets/js/52.76e8279f.js"><link rel="prefetch" href="/assets/js/53.766085c5.js"><link rel="prefetch" href="/assets/js/54.762d576d.js"><link rel="prefetch" href="/assets/js/55.a0bacbad.js"><link rel="prefetch" href="/assets/js/56.88b21fa9.js"><link rel="prefetch" href="/assets/js/57.edb3c596.js"><link rel="prefetch" href="/assets/js/58.83426543.js"><link rel="prefetch" href="/assets/js/59.e6b35962.js"><link rel="prefetch" href="/assets/js/6.f6480706.js"><link rel="prefetch" href="/assets/js/60.42418b0a.js"><link rel="prefetch" href="/assets/js/61.986a3c55.js"><link rel="prefetch" href="/assets/js/62.dc61b062.js"><link rel="prefetch" href="/assets/js/63.7270a456.js"><link rel="prefetch" href="/assets/js/64.7f8fdce9.js"><link rel="prefetch" href="/assets/js/65.35c2a749.js"><link rel="prefetch" href="/assets/js/66.265df582.js"><link rel="prefetch" href="/assets/js/68.eb5cc45e.js"><link rel="prefetch" href="/assets/js/69.38f41b07.js"><link rel="prefetch" href="/assets/js/7.7d7d0d81.js"><link rel="prefetch" href="/assets/js/70.3a9646e8.js"><link rel="prefetch" href="/assets/js/71.fd691e65.js"><link rel="prefetch" href="/assets/js/72.779f8e2d.js"><link rel="prefetch" href="/assets/js/73.b98034f7.js"><link rel="prefetch" href="/assets/js/74.dc317e9a.js"><link rel="prefetch" href="/assets/js/75.2da86225.js"><link rel="prefetch" href="/assets/js/76.12d74630.js"><link rel="prefetch" href="/assets/js/77.0748e04e.js"><link rel="prefetch" href="/assets/js/78.2a0a7e5d.js"><link rel="prefetch" href="/assets/js/79.5d39e898.js"><link rel="prefetch" href="/assets/js/8.b0447022.js"><link rel="prefetch" href="/assets/js/80.02d143a0.js"><link rel="prefetch" href="/assets/js/81.b3890429.js"><link rel="prefetch" href="/assets/js/82.3d1e0f8a.js"><link rel="prefetch" href="/assets/js/83.0c806b49.js"><link rel="prefetch" href="/assets/js/84.b7e2ccc2.js"><link rel="prefetch" href="/assets/js/85.979cbad2.js"><link rel="prefetch" href="/assets/js/86.81e560c6.js"><link rel="prefetch" href="/assets/js/9.68721d1e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.13931c1a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">enaoi's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/" class="nav-link">
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/libs/" class="nav-link">
  库
</a></li><li class="dropdown-item"><!----> <a href="/http/" class="nav-link">
  Http
</a></li><li class="dropdown-item"><!----> <a href="/tools/" class="nav-link">
  Tools
</a></li><li class="dropdown-item"><!----> <a href="/datastructures/" class="nav-link">
  数据结构
</a></li></ul></div></div><div class="nav-item"><a href="/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="生态系统" class="dropdown-title"><span class="title">生态系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          MVVM框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-subitem"><a href="/react/" class="nav-link router-link-active">
  react
</a></li><li class="dropdown-subitem"><a href="/angular/" class="nav-link">
  angular
</a></li></ul></li><li class="dropdown-item"><h4>
          Node
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/nodejs/" class="nav-link">
  nodejs
</a></li><li class="dropdown-subitem"><a href="/koa/" class="nav-link">
  koa
</a></li><li class="dropdown-subitem"><a href="/express.html" class="nav-link">
  express
</a></li></ul></li><li class="dropdown-item"><h4>
          打包
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-subitem"><a href="/vite/" class="nav-link">
  vite
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="阅读" class="dropdown-title"><span class="title">阅读</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/books/" class="nav-link">
  技术类
</a></li><li class="dropdown-item"><!----> <a href="/reading/" class="nav-link">
  文学类
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><span class="title">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/git/" class="nav-link">
  git
</a></li><li class="dropdown-subitem"><a href="/vscode/" class="nav-link">
  vscode
</a></li></ul></li><li class="dropdown-item"><h4>
          其它
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/computer/" class="nav-link">
  计算机
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/enaoi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/" class="nav-link">
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/libs/" class="nav-link">
  库
</a></li><li class="dropdown-item"><!----> <a href="/http/" class="nav-link">
  Http
</a></li><li class="dropdown-item"><!----> <a href="/tools/" class="nav-link">
  Tools
</a></li><li class="dropdown-item"><!----> <a href="/datastructures/" class="nav-link">
  数据结构
</a></li></ul></div></div><div class="nav-item"><a href="/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="生态系统" class="dropdown-title"><span class="title">生态系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          MVVM框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-subitem"><a href="/react/" class="nav-link router-link-active">
  react
</a></li><li class="dropdown-subitem"><a href="/angular/" class="nav-link">
  angular
</a></li></ul></li><li class="dropdown-item"><h4>
          Node
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/nodejs/" class="nav-link">
  nodejs
</a></li><li class="dropdown-subitem"><a href="/koa/" class="nav-link">
  koa
</a></li><li class="dropdown-subitem"><a href="/express.html" class="nav-link">
  express
</a></li></ul></li><li class="dropdown-item"><h4>
          打包
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-subitem"><a href="/vite/" class="nav-link">
  vite
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="阅读" class="dropdown-title"><span class="title">阅读</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/books/" class="nav-link">
  技术类
</a></li><li class="dropdown-item"><!----> <a href="/reading/" class="nav-link">
  文学类
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><span class="title">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/git/" class="nav-link">
  git
</a></li><li class="dropdown-subitem"><a href="/vscode/" class="nav-link">
  vscode
</a></li></ul></li><li class="dropdown-item"><h4>
          其它
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/computer/" class="nav-link">
  计算机
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/enaoi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/react/" aria-current="page" class="sidebar-link">概念</a></li><li><a href="/react/create_react_app.html" class="sidebar-link">Create React App</a></li><li><a href="/react/react_context.html" class="sidebar-link">React 之 Context</a></li><li><a href="/react/react_hook.html" class="sidebar-link">React Hooks</a></li><li><a href="/react/react_hook_getData.html" class="sidebar-link">React Hooks - 请求数据</a></li><li><a href="/react/react_redux.html" class="sidebar-link">React Redux</a></li><li><a href="/react/react_router.html" class="sidebar-link">React Router</a></li><li><a href="/react/redux_start_with_Dan_Abramov.html" aria-current="page" class="active sidebar-link">Getting Start With Redux</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_1-the-single-immutable-state-tree" class="sidebar-link">1. The Single Immutable State Tree</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_2-describing-state-changes-with-actions" class="sidebar-link">2. Describing State Changes with Actions</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_3-pure-and-impure-functions" class="sidebar-link">3. Pure and Impure Functions</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_4-the-reducer-function" class="sidebar-link">4. The Reducer Function</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_5-writing-a-counter-reducer-with-tests" class="sidebar-link">5. Writing a Counter Reducer with Tests</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_6-store-methods-getstate-dispatch-subscribe" class="sidebar-link">6. Store Methods: getState(), dispatch(), subscribe()</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_7-implementing-createstore-from-scratch" class="sidebar-link">7. Implementing createStore from Scratch</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_8-react-counter-example" class="sidebar-link">8. React counter example</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_9-avoiding-array-mutations" class="sidebar-link">9. Avoiding Array Mutations</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_10-avoding-object-mutations-with-object-assign-and-spread" class="sidebar-link">10. Avoding Object Mutations with Object.assign() and ...spread</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_11-12-writing-a-todo-list-reducer" class="sidebar-link">11-12. writing a Todo List reducer</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_13-reducer-composition-with-arrays" class="sidebar-link">13. reducer Composition with Arrays</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_14-reducer-composition-with-objects" class="sidebar-link">14. Reducer Composition with Objects</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_15-reducer-composition-with-combinereducers" class="sidebar-link">15. Reducer Composition with combineReducers()</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_16-implementing-combinereducers-from-scratch" class="sidebar-link">16. Implementing combineReducers() from Scratch</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_17-19-react-todo-list-example" class="sidebar-link">17-19. React Todo List Example</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_20-extracting-presentational-components-todo-todolist" class="sidebar-link">20.Extracting Presentational Components(Todo, Todolist)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#presentational-components" class="sidebar-link">presentational components</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_21-extractiong-presentational-components-addtodo-footer-filterlink" class="sidebar-link">21. Extractiong  Presentational Components(AddTodo, Footer, FilterLink)</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_21-extracting-container-components-filterlink" class="sidebar-link">21. Extracting Container Components(FilterLink)</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_23-extraction-container-components-visibletodolist-addtodo" class="sidebar-link">23. Extraction Container Components(VisibleTodoList, AddTodo)</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_24-passing-the-store-down-explicitly-via-props" class="sidebar-link">24. Passing the Store Down Explicitly via Props</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_25-passing-the-store-down-implicitly-via-content" class="sidebar-link">25. Passing the Store Down Implicitly via Content</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#functional-component" class="sidebar-link">functional Component</a></li></ul></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_26-passing-the-store-down-with-provide-from-react-redux" class="sidebar-link">26. Passing the Store Down with &lt;Provide&gt; from React Redux</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_27-generating-containers-with-connect-from-react-redux-visibletodolist" class="sidebar-link">27. Generating Containers with connect() from react-redux (visibleTodoList)</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_28-generating-containers-with-connect-from-react-redux-addtodo" class="sidebar-link">28. Generating Containers with connect() from React Redux (AddTodo)</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#_29-generating-containers-with-connect-from-react-redux-footerlink" class="sidebar-link">29. Generating Containers with connect() from React Redux (FooterLink)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#persisteddata" class="sidebar-link">persistedData</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#wrapping-dispatch-to-log-actions" class="sidebar-link">wrapping dispatch() to log actions</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#adding-a-fake-backend-to-the-project" class="sidebar-link">adding a fake backend to the project</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#dispatching-actions-with-the-fetched-data" class="sidebar-link">dispatching actions with the fetched data</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#wrapping-dispatch-to-recongize-promise" class="sidebar-link">wrapping dispatch() to recongize Promise</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#middleware-chain" class="sidebar-link">middleware chain</a></li><li class="sidebar-sub-header"><a href="/react/redux_start_with_Dan_Abramov.html#applying-redux-applymiddleware" class="sidebar-link">applying redux applyMiddleware</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="getting-start-with-redux"><a href="#getting-start-with-redux" class="header-anchor">#</a> Getting Start With Redux</h1> <h2 id="_1-the-single-immutable-state-tree"><a href="#_1-the-single-immutable-state-tree" class="header-anchor">#</a> 1. The Single Immutable State Tree</h2> <p>Redux 原则一:</p> <blockquote><p>The entire state of the application will be represented by one JavaScript object.<br>
整个应用的状态表现在一个 JavaScript 对象中</p></blockquote> <h2 id="_2-describing-state-changes-with-actions"><a href="#_2-describing-state-changes-with-actions" class="header-anchor">#</a> 2. Describing State Changes with Actions</h2> <p>Redux 原则二:</p> <blockquote><p>the state tree is read only<br>
state 是只读的</p></blockquote> <p>Any time you want to change the state , you have to dispatch an action. An action is a plain JS object describing the change.</p> <p>Just like the state is the minimal representation of the data, an action is the minimal representation of the change to that data.</p> <h2 id="_3-pure-and-impure-functions"><a href="#_3-pure-and-impure-functions" class="header-anchor">#</a> 3. Pure and Impure Functions</h2> <p>纯函数：相同的输入永远得到相同的输出，且不改变任何数据。</p> <h2 id="_4-the-reducer-function"><a href="#_4-the-reducer-function" class="header-anchor">#</a> 4. The Reducer Function</h2> <p>React introduced the idea that the UI layer is most predictable when it is described as a pure function of the application's state.</p> <p>Redux complements this approach by requiring that state mutations in your app need to be described by a pure function that takes the previous state and the action being dispatched, and returns the next state of your application.</p> <p>It's important that function is pure.</p> <p>Redux 原则三:</p> <blockquote><p>to describe state mutations you have to write a function that takes the previous state of the app and the action being dispatched, then returns the next state of the app. This function is called the <strong>Reducer</strong>.</p></blockquote> <h2 id="_5-writing-a-counter-reducer-with-tests"><a href="#_5-writing-a-counter-reducer-with-tests" class="header-anchor">#</a> 5. Writing a Counter Reducer with Tests</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>const counter = (state = 0, action) =&gt; {
  switch (action.type) {
    case 'INCREMENT':
      return state + 1
    case 'DECREMENT':
      return state - 1
    default:
      return state
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这里我使用的是facebook的<code>jest</code>库,新建了一个<code>counter.test.js</code>文件。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const counter = require('./counter')

test('state 0 Increment  equal 1', () =&gt; {
  expect(counter(0, { type: 'INCREMENT' })).toBe(1)
})
test('state 1 Increment  equal 2', () =&gt; {
  expect(counter(1, { type: 'INCREMENT' })).toBe(2)
})
test('state 2 Decrement  equal 1', () =&gt; {
  expect(counter(2, { type: 'DECREMENT' })).toBe(1)
})

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><code>package.json</code>文件</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest&quot;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>运行</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>yarn test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_6-store-methods-getstate-dispatch-subscribe"><a href="#_6-store-methods-getstate-dispatch-subscribe" class="header-anchor">#</a> 6. Store Methods: <code>getState()</code>, <code>dispatch()</code>, <code>subscribe()</code></h2> <p>我们可以将<code>state</code>显示在页面上</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>

<span class="token keyword">const</span> <span class="token function-variable function">counter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'INCREMENT'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string">'DECREMENT'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span>

store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerText <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'INCREMENT'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="_7-implementing-createstore-from-scratch"><a href="#_7-implementing-createstore-from-scratch" class="header-anchor">#</a> 7. Implementing createStore from Scratch</h2> <p>为了更好的理解 <code>createStore</code> 方法，从零开始手动实现一个。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">createStore</span> <span class="token operator">=</span> <span class="token parameter">reducer</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> state
  <span class="token comment">/**
   * subscribe()方法可以多次调用，所以我们需要一个数组来保存所有的listener
   * 每当subscribe()方法被调用时，我们就将新的listener放入数组中
   **/</span>
  <span class="token keyword">let</span> listeners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

  <span class="token keyword">const</span> <span class="token function-variable function">getState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state
  <span class="token comment">/**
   * dispatch是唯一改变内部state的方法，
   * 我们调用reducer和当前state以及传入的action算出一个新的state
   * 当state被更新后，我们调用所有listener来通知变更。
   **/</span>
  <span class="token keyword">const</span> <span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token parameter">action</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span>
    listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">listener</span> <span class="token operator">=&gt;</span> <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * In order to unsubscribe an event listener,
   * we'll return a function from the subscribe() method that removes the listener from the listeners array.
   */</span>
  <span class="token keyword">const</span> <span class="token function-variable function">subscribe</span> <span class="token operator">=</span> <span class="token parameter">listener</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    listeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      listeners <span class="token operator">=</span> listeners<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">l</span> <span class="token operator">=&gt;</span> l <span class="token operator">!==</span> listener<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// dummy dispatch, return the initial state</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> getState<span class="token punctuation">,</span> dispatch<span class="token punctuation">,</span> subscribe <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h2 id="_8-react-counter-example"><a href="#_8-react-counter-example" class="header-anchor">#</a> 8. React counter example</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>import React from 'react'
import ReactDOM from 'react-dom'
import { createStore } from 'redux'

const counter = (state = 0, action) =&gt; {
  switch (action.type) {
    case 'INCREMENT':
      return state + 1
    case 'DECREMENT':
      return state - 1
    default:
      return state
  }
}

const store = createStore(counter)

const Counter = ({ value, onIncrement, onDecrement }) =&gt; (
  &lt;div&gt;
    &lt;h1&gt;{value}&lt;/h1&gt;
    &lt;button onClick={onIncrement}&gt;+&lt;/button&gt;
    &lt;button onClick={onDecrement}&gt;-&lt;/button&gt;
  &lt;/div&gt;
)

const render = () =&gt; {
  ReactDOM.render(
    &lt;Counter
      value={store.getState()}
      onIncrement={() =&gt; store.dispatch({ type: 'INCREMENT' })}
      onDecrement={() =&gt; store.dispatch({ type: 'DECREMENT' })}
    /&gt;,
    document.getElementById('root')
  )
}

store.subscribe(render)
render()
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h2 id="_9-avoiding-array-mutations"><a href="#_9-avoiding-array-mutations" class="header-anchor">#</a> 9. Avoiding Array Mutations</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> deepFreeze <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'deep-freeze'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">addCounter</span> <span class="token operator">=</span> <span class="token parameter">list</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> list
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">testAddCounter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> listBefore <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> listAfter <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  
  <span class="token function">deepFreeze</span><span class="token punctuation">(</span>listBefore<span class="token punctuation">)</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'[] addCounter equals [0]'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">addCounter</span><span class="token punctuation">(</span>listBefore<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>listAfter<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">testAddCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>输出结果</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>TypeError: Cannot add property 0, object is not extensible
        at Array.push (&lt;anonymous&gt;)
Test Suites: 1 failed, 1 total
Tests:       1 failed, 1 total
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Array改变原数组的操作方法:
<code>push</code>,<code>pop</code>,<code>shift</code>,<code>unshift</code>,<code>reverse</code>,<code>splice</code>,<code>sort</code></p> <p>不改变原数组的方法:
<code>concat</code>,<code>slice</code>,<code>map</code>,<code>filter</code></p> <p>所以对于数组的增删改查，我们可以这样写:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">removeCounter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// old way:</span>
  <span class="token comment">// return list.slice(0, index).concat(list.slice(index + 1))</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>list<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>list<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>


<span class="token keyword">const</span> <span class="token function-variable function">incrementCounter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span>list<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    list<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>list<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="_10-avoding-object-mutations-with-object-assign-and-spread"><a href="#_10-avoding-object-mutations-with-object-assign-and-spread" class="header-anchor">#</a> 10. Avoding Object Mutations with <code>Object.assign()</code> and ...spread</h2> <p>导致了对象突变：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const toggleTodo = todo =&gt; {
  todo.completed = !todo.completed
  return todo
}

const testToggleTodo = () =&gt; {
  const todoBefore = {
    id: 0,
    text: 'Learn Redux',
    completed: false
  }
  const todoAfter = {
    id: 0,
    text: 'Learn Redux',
    completed: true
  }

  deepFreeze(todoBefore)
  expect(toggleTodo(todoBefore)).toEqual(todoAfter)
}

testToggleTodo()

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><strong>解决方案：</strong></p> <ol><li>ES6 --&gt; Object.assign()</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>const toggleTodo = (todo) =&gt; {
  return Object.assign({}, todo, {
    completed: !todo.completed
  });
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>ES7 --&gt; spread</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>const toggleTodo = (todo) =&gt; {
  return {
    ...todo,
      completed: !todo.completed
  };
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_11-12-writing-a-todo-list-reducer"><a href="#_11-12-writing-a-todo-list-reducer" class="header-anchor">#</a> 11-12. writing a Todo List reducer</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">todos</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'ADD_TODO'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          id<span class="token operator">:</span> action<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
          text<span class="token operator">:</span> action<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
          completed<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token keyword">case</span> <span class="token string">'TOGGLE_TODO'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>todo<span class="token punctuation">.</span>id <span class="token operator">!==</span> action<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> todo
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token operator">...</span>todo<span class="token punctuation">,</span>
            completed<span class="token operator">:</span> <span class="token operator">!</span>todo<span class="token punctuation">.</span>completed
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="_13-reducer-composition-with-arrays"><a href="#_13-reducer-composition-with-arrays" class="header-anchor">#</a> 13. reducer Composition with Arrays</h2> <p>上面的TODO reducer混合了两种内容：update todos和update an todo。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">todo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'ADD_TODO'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> action<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
        text<span class="token operator">:</span> action<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
        completed<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'TOGGLE_TODO'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>id <span class="token operator">!==</span> action<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> state
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token operator">!</span>state<span class="token punctuation">.</span>completed <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">todos</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'ADD_TODO'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token function">todo</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">case</span> <span class="token string">'TOGGLE_TODO'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token function">todo</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="_14-reducer-composition-with-objects"><a href="#_14-reducer-composition-with-objects" class="header-anchor">#</a> 14. Reducer Composition with Objects</h2> <p>大部分情况下我们的state不会是一个数组，而是一个对象。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> visiblilityFilter <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token string">'SHOW_ALL'</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'SET_VISIBILITY_FILTER'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> action<span class="token punctuation">.</span>filter
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">todoApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
   <span class="token comment">// Call the todos() reducer from last section</span>
    todos<span class="token operator">:</span> <span class="token function">todos</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>todos<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">,</span>
    visiblilityFilter<span class="token operator">:</span> <span class="token function">visiblilityFilter</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>visiblilityFilter<span class="token punctuation">,</span> action<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="_15-reducer-composition-with-combinereducers"><a href="#_15-reducer-composition-with-combinereducers" class="header-anchor">#</a> 15. Reducer Composition with <code>combineReducers()</code></h2> <p>由于reducer的合并在使用redux中是十分常见的情况，于是有一个已经集成好的函数<code>combineReducers</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// overwrite last section's todoApp by combineReducers()</span>
<span class="token keyword">const</span> todoApp <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  todos<span class="token punctuation">,</span>
  visiblilityFilter
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_16-implementing-combinereducers-from-scratch"><a href="#_16-implementing-combinereducers-from-scratch" class="header-anchor">#</a> 16. Implementing <code>combineReducers()</code> from Scratch</h2> <p>让我们来手动实现一下 <code>combineReducers()</code> 来加深理解：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">combineReducers</span> <span class="token operator">=</span> <span class="token parameter">reducers</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>reducers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">nextState<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      nextState<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> reducers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span>state<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span>
      <span class="token keyword">return</span> nextState
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_17-19-react-todo-list-example"><a href="#_17-19-react-todo-list-example" class="header-anchor">#</a> 17-19. React Todo List Example</h2> <p>手动实现一个 react 版本的 Todo list。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> serviceWorker <span class="token keyword">from</span> <span class="token string">'./serviceWorker'</span>

<span class="token keyword">const</span> <span class="token function-variable function">todo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'ADD_TODO'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> action<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
        text<span class="token operator">:</span> action<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
        completed<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'TOGGLE_TODO'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>id <span class="token operator">!==</span> action<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> state
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token operator">!</span>state<span class="token punctuation">.</span>completed <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">todos</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'ADD_TODO'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token function">todo</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">case</span> <span class="token string">'TOGGLE_TODO'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token function">todo</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> visiblilityFilter <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> <span class="token string">'SHOW_ALL'</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'SET_VISIBILITY_FILTER'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> action<span class="token punctuation">.</span>filter
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> todoApp <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  todos<span class="token punctuation">,</span>
  visiblilityFilter
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> nextTodoId <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">const</span> <span class="token function-variable function">FilterLink</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> filter<span class="token punctuation">,</span> currentFilter<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>filter <span class="token operator">===</span> currentFilter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>a
        href<span class="token operator">=</span><span class="token string">&quot;#as&quot;</span>
        onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            type<span class="token operator">:</span> <span class="token string">'SET_VISIBILITY_FILTER'</span><span class="token punctuation">,</span>
            filter
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">getVisibleTodos</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">todos<span class="token punctuation">,</span> filter</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>filter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'SHOW_ALL'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> todos
    <span class="token keyword">case</span> <span class="token string">'SHOW_COMPLETED'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>completed<span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token string">'SHOW_ACTIVE'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>t<span class="token punctuation">.</span>completed<span class="token punctuation">)</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> todos
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">TodoApp</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> todos<span class="token punctuation">,</span> visiblilityFilter <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token keyword">const</span> visibleTodos <span class="token operator">=</span> <span class="token function">getVisibleTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> visiblilityFilter<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input
          ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">node</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>input <span class="token operator">=</span> node
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button
          onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              type<span class="token operator">:</span> <span class="token string">'ADD_TODO'</span><span class="token punctuation">,</span>
              text<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
              id<span class="token operator">:</span> nextTodoId<span class="token operator">++</span><span class="token punctuation">,</span>
              completed<span class="token operator">:</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&gt;</span>
          Add Todo
        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
          <span class="token punctuation">{</span>visibleTodos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>li
              key<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>id<span class="token punctuation">}</span>
              style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
                textDecoration<span class="token operator">:</span> todo<span class="token punctuation">.</span>completed <span class="token operator">?</span> <span class="token string">'line-through'</span> <span class="token operator">:</span> <span class="token string">'none'</span>
              <span class="token punctuation">}</span><span class="token punctuation">}</span>
              onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'TOGGLE_TODO'</span><span class="token punctuation">,</span> id<span class="token operator">:</span> todo<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
            <span class="token operator">&gt;</span>
              <span class="token punctuation">{</span>todo<span class="token punctuation">.</span>text<span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
          Show<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span>FilterLink filter<span class="token operator">=</span><span class="token string">&quot;SHOW_ALL&quot;</span> currentFilter<span class="token operator">=</span><span class="token punctuation">{</span>visiblilityFilter<span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token constant">ALL</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>FilterLink<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span>FilterLink filter<span class="token operator">=</span><span class="token string">&quot;SHOW_ACTIVE&quot;</span> currentFilter<span class="token operator">=</span><span class="token punctuation">{</span>visiblilityFilter<span class="token punctuation">}</span><span class="token operator">&gt;</span>
            Active
          <span class="token operator">&lt;</span><span class="token operator">/</span>FilterLink<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span>FilterLink filter<span class="token operator">=</span><span class="token string">&quot;SHOW_COMPLETED&quot;</span> currentFilter<span class="token operator">=</span><span class="token punctuation">{</span>visiblilityFilter<span class="token punctuation">}</span><span class="token operator">&gt;</span>
            Completed
          <span class="token operator">&lt;</span><span class="token operator">/</span>FilterLink<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>TodoApp <span class="token punctuation">{</span><span class="token operator">...</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>todoApp<span class="token punctuation">)</span>
store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br></div></div><h2 id="_20-extracting-presentational-components-todo-todolist"><a href="#_20-extracting-presentational-components-todo-todolist" class="header-anchor">#</a> 20.Extracting Presentational Components(Todo, Todolist)</h2> <p>我们将上面一个整体的component拆分开来，方便测试以及被其它组件调用。首先就是将单个Todo作为一个独立组件：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const Todo = ({ onClick, completed, text }) =&gt; (
  &lt;li
    onClick={onClick}
    style={{ textDecoration: completed ? 'line-through' : 'none' }}
  &gt;
    {text}
  &lt;/li&gt;
)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>我们再构建一个TodoList 组件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const TodoList = ({ todos, onTodoClick }) =&gt; (
  &lt;ul&gt;
    {todos.map(todo =&gt; (
      &lt;Todo
        key={todo.id}
        onClick={() =&gt; onTodoClick(todo.id)}
        completed={todo.completed}
        text={todo.text}
      /&gt;
    ))}
  &lt;/ul&gt;
)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="presentational-components"><a href="#presentational-components" class="header-anchor">#</a> presentational components</h3> <p>Previously we had hardcoded a click handler that dispatched 'TOGGLE_TODO'. It's best practice with React to have several components that don't specify any behaviors, and only are concerned with how things are rendered (how they look). These are called <strong>presentational components</strong>.</p> <h2 id="_21-extractiong-presentational-components-addtodo-footer-filterlink"><a href="#_21-extractiong-presentational-components-addtodo-footer-filterlink" class="header-anchor">#</a> 21. Extractiong  Presentational Components(AddTodo, Footer, FilterLink)</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">AddTodo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onClick <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> input
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input
        ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">node</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          input <span class="token operator">=</span> node
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button
        onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">onClick</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
          input<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">&gt;</span>
        Add Todo
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">Footer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> visiblilityFilter<span class="token punctuation">,</span> onFilterClick <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
    Show<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>FilterLink
      filter<span class="token operator">=</span><span class="token string">&quot;SHOW_ALL&quot;</span>
      currentFilter<span class="token operator">=</span><span class="token punctuation">{</span>visiblilityFilter<span class="token punctuation">}</span>
      onClick<span class="token operator">=</span><span class="token punctuation">{</span>onFilterClick<span class="token punctuation">}</span>
    <span class="token operator">&gt;</span>
      <span class="token constant">ALL</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>FilterLink<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>FilterLink
      filter<span class="token operator">=</span><span class="token string">&quot;SHOW_ACTIVE&quot;</span>
      currentFilter<span class="token operator">=</span><span class="token punctuation">{</span>visiblilityFilter<span class="token punctuation">}</span>
      onClick<span class="token operator">=</span><span class="token punctuation">{</span>onFilterClick<span class="token punctuation">}</span>
    <span class="token operator">&gt;</span>
      Active
    <span class="token operator">&lt;</span><span class="token operator">/</span>FilterLink<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>FilterLink
      filter<span class="token operator">=</span><span class="token string">&quot;SHOW_COMPLETED&quot;</span>
      currentFilter<span class="token operator">=</span><span class="token punctuation">{</span>visiblilityFilter<span class="token punctuation">}</span>
      onClick<span class="token operator">=</span><span class="token punctuation">{</span>onFilterClick<span class="token punctuation">}</span>
    <span class="token operator">&gt;</span>
      Completed
    <span class="token operator">&lt;</span><span class="token operator">/</span>FilterLink<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h2 id="_21-extracting-container-components-filterlink"><a href="#_21-extracting-container-components-filterlink" class="header-anchor">#</a> 21. Extracting Container Components(FilterLink)</h2> <p>之前拆开的几个组件内部都没有直接调用dispatch方法，而是通过props的方式。他们都只是UI外观上的响应，而不是动作。</p> <p>而这种实现方式的缺点是非常多的props需要一层一层的传递下去。即使中间层组件可能并不需要这个参数。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 只负责渲染样式的组件
const Link = ({ active, children, onClick }) =&gt; {
  if (active) {
    return &lt;span&gt;{children}&lt;/span&gt;
  }
  return (
    &lt;a
      href=&quot;#1&quot;
      onClick={e =&gt; {
        e.preventDefault()
        onClick()
      }}
    &gt;
      {children}
    &lt;/a&gt;
  )
}

class FilterLink extends Component {
  componentDidMount() {
    this.unsubscribe = store.subscribe(() =&gt; this.forceUpdate())
  }

  componentWillUnmount() {
    this.unsubscribe()
  }
  render() {
    const props = this.props
    const state = store.getState()
    return (
      &lt;Link
        active={props.filter === state.visiblilityFilter}
        onClick={() =&gt;
          store.dispatch({
            type: 'SET_VISIBILITY_FILTER',
            filter: props.filter
          })
        }
      &gt;
        {props.children}
      &lt;/Link&gt;
    )
  }
}


const Footer = () =&gt; (
  &lt;p&gt;
    Show: &lt;FilterLink filter=&quot;SHOW_ALL&quot;&gt;ALL&lt;/FilterLink&gt;{' '}
    &lt;FilterLink filter=&quot;SHOW_ACTIVE&quot;&gt;Active&lt;/FilterLink&gt;{' '}
    &lt;FilterLink filter=&quot;SHOW_COMPLETED&quot;&gt;Completed&lt;/FilterLink&gt;
  &lt;/p&gt;
)

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h2 id="_23-extraction-container-components-visibletodolist-addtodo"><a href="#_23-extraction-container-components-visibletodolist-addtodo" class="header-anchor">#</a> 23. Extraction Container Components(VisibleTodoList, AddTodo)</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>class VisibleTodos extends Component {
  componentDidMount() {
    this.unsubscribe = store.subscribe(() =&gt; this.forceUpdate())
  }

  componentWillUnmount() {
    this.unsubscribe()
  }

  render() {
    const state = store.getState()

    return (
      &lt;TodoList
        todos={getVisibleTodos(state.todos, state.visiblilityFilter)}
        onTodoClick={id =&gt; store.dispatch({ type: 'TOGGLE_TODO', id })}
      /&gt;
    )
  }
}

const AddTodo = () =&gt; {
  let input
  return (
    &lt;div&gt;
      &lt;input
        ref={node =&gt; {
          input = node
        }}
      /&gt;
      &lt;button
        onClick={() =&gt; {
          store.dispatch({
            type: 'ADD_TODO',
            id: nextTodoId++,
            text: input.text
          })
          input.value = ''
        }}
      &gt;
        Add Todo
      &lt;/button&gt;
    &lt;/div&gt;
  )
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>这时，我们的TodoApp已经简化为</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>class TodoApp extends Component {
  render() {
    return (
      &lt;div&gt;
        &lt;AddTodo /&gt;
        &lt;VisibleTodos /&gt;
        &lt;Footer /&gt;
      &lt;/div&gt;
    )
  }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>我们也可以将render函数移除了，因为 TodoApp 只需要再初始化的时候render一次即可。</p> <h2 id="_24-passing-the-store-down-explicitly-via-props"><a href="#_24-passing-the-store-down-explicitly-via-props" class="header-anchor">#</a> 24. Passing the Store Down Explicitly via Props</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>const { combineReducers, createStore } = Redux;

const todoApp = combineReducers({
  todos,
  visibilityFilter
});

const store = createStore(todoApp);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>当store被建立后，容器组件:</p> <ul><li>获取数据： <code>store.getState()</code></li> <li>订阅变化:  <code>store.subscribe()</code></li> <li>发起动作:  <code>store.dispatch()</code></li></ul> <p>我们通过createStore方法将<code>todoApp</code>reducers传入后得到了一个store变量。但这样会有两个缺点:</p> <ol><li>组件难以测试。</li> <li>难以实现服务端渲染。服务端渲染对不同的request提供不同的store实例。</li></ol> <p>解决办法就是
before:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const store = createStore(todoApp);

ReactDOM.render(
  &lt;TodoApp /&gt;,
  document.getElementById('root')
);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>after:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ReactDOM.render(
  &lt;TodoApp store={createStore(todoApp)} /&gt;,
  document.getElementById('root')
);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>之后所有的子组件都加上props为store....</p> <h2 id="_25-passing-the-store-down-implicitly-via-content"><a href="#_25-passing-the-store-down-implicitly-via-content" class="header-anchor">#</a> 25. Passing the Store Down Implicitly via Content</h2> <p>前一个模块中，我们通过props传递store。导致了一堆的样板代码：</p> <p>有一个简单的解决方案： 使用react的 context 功能</p> <ol><li>先写一个简单的 Provider component,仅仅返回它的child</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>class Provider extends Component {
  render() {
    return this.props.children
  }
}

// 重写
ReactDOM.render(
  &lt;Provider store={createStore(todoApp)}&gt;
    &lt;TodoApp /&gt;
  &lt;/Provider&gt;,
  document.getElementById('root')
)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="2"><li>现在使用 React’s context 功能升级 Provider component</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>class Provider extends Component {
  getChildContext() {
    return {
      store: this.props.store
    }
  }
  render() {
    return this.props.children
  }
}

Provider.childContextTypes = {
  store: React.PropTypes.object
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><code>VisibleTodos</code> 可以使用 <code>this.context</code> 来获取store的内容</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>class VisibleTodos extends Component {
  componentDidMount() {
    const { store } = this.context
    this.unsubscribe = store.subscribe(() =&gt; this.forceUpdate())
  }

  componentWillUnmount() {
    this.unsubscribe()
  }

  render() {
    const { store } = this.context
    const state = store.getState()

    return (
      &lt;TodoList
        todos={getVisibleTodos(state.todos, state.visiblilityFilter)}
        onTodoClick={id =&gt; store.dispatch({ type: 'TOGGLE_TODO', id })}
      /&gt;
    )
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><blockquote><p><mark><strong>Note:</strong> The context is opt-in for all components, so we have to specify contextTypes. If you don't specify this, the component won't receive the relevant context, so it is essential to declare them!</mark>
必须声明 contextTypes 的类型 否则component不会接收相关context。</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>VisibleTodoList.contextTypes = {
  store: React.PropTypes.object
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="functional-component"><a href="#functional-component" class="header-anchor">#</a> functional Component</h3> <p>与之前的相对应哦</p> <h2 id="_26-passing-the-store-down-with-provide-from-react-redux"><a href="#_26-passing-the-store-down-with-provide-from-react-redux" class="header-anchor">#</a> 26. Passing the Store Down with <code>&lt;Provide&gt;</code> from React Redux</h2> <p>'react-redux' 封装了一个 <code>Provider</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import { Provider } from 'react-redux';
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_27-generating-containers-with-connect-from-react-redux-visibletodolist"><a href="#_27-generating-containers-with-connect-from-react-redux-visibletodolist" class="header-anchor">#</a> 27. Generating Containers with <code>connect()</code> from react-redux (visibleTodoList)</h2> <p>Our container components are similar:</p> <ul><li>they need to re-render when the store's state changes,</li> <li>they need to unsubscribe from the store when they unmount</li> <li>they take the current state from the Redux store and use it to render the presentational components with some props that they calculate.</li> <li>They also need to specify the contextTypes to get the store from the context.</li></ul> <p>我们现在来改写一下<code>VisibleTodoList</code>,它主要就是以上列举的操作，以及将props传入的数据传递给子元素，我们使用<code>connect</code>方法可以改写成以下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// before
class VisibleTodos extends Component {
  componentDidMount() {
    const { store } = this.context
    this.unsubscribe = store.subscribe(() =&gt; this.forceUpdate())
  }

  componentWillUnmount() {
    this.unsubscribe()
  }

  render() {
    const { store } = this.context
    const state = store.getState()

    return (
      &lt;TodoList
        todos={getVisibleTodos(state.todos, state.visiblilityFilter)}
        onTodoClick={id =&gt; store.dispatch({ type: 'TOGGLE_TODO', id })}
      /&gt;
    )
  }
}

// after
const mapStateToProps = state =&gt; {
   return {
     todos: getVisibleTodos(state.todos, state.visiblilityFilter)
   }
}

const mapDispatchToProps = (dispatch) =&gt; {
  return {
    onTodoClick: (id) =&gt; {
      dispatch({
        type: 'TOGGLE_TODO',
        id
      })
    }
  }
}

const VisibleTodos = connect(mapStateToProps, mapDispatchToProps)(TodoList)

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>he connect() function will generate the component just like the one we wrote by hand, so we don't have to write the code to subscribe to the store or to specify the context types manually.</p> <h2 id="_28-generating-containers-with-connect-from-react-redux-addtodo"><a href="#_28-generating-containers-with-connect-from-react-redux-addtodo" class="header-anchor">#</a> 28. Generating Containers with connect() from React Redux (AddTodo)</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>let AddTodo = dispatch =&gt; {
  let input
  return (
    &lt;div&gt;
      &lt;input
        ref={node =&gt; {
          input = node
        }}
      /&gt;
      &lt;button
        onClick={() =&gt; {
          dispatch({
            type: 'ADD_TODO',
            id: nextTodoId++,
            text: input.text
          })
          input.value = ''
        }}
      &gt;
        Add Todo
      &lt;/button&gt;
    &lt;/div&gt;
  )
}

AddTodo = connect()(AddTodo)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="_29-generating-containers-with-connect-from-react-redux-footerlink"><a href="#_29-generating-containers-with-connect-from-react-redux-footerlink" class="header-anchor">#</a> 29. Generating Containers with connect() from React Redux (FooterLink)</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>
## 待详解
- [ ] getChildContext()
- [ ] this.forceUpdate


# Idomatioc Redux course
sometimes we want to load data into the store synchronously before the application starts.

Redux lets us pass a persistedState as the second argument to the createStore function:

​```javascript
const persistedState = {
  todos: [{
    id: 0,
    text: 'Welcome Back!',
    completed: false
  }]
}

const store = createStore(
  todoApp,
  persistedState
)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="persisteddata"><a href="#persisteddata" class="header-anchor">#</a> persistedData</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> loadState<span class="token punctuation">,</span> saveState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./localStorage'</span>
<span class="token keyword">const</span> persistedState <span class="token operator">=</span> <span class="token function">loadState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>todoApp<span class="token punctuation">,</span> persistedState<span class="token punctuation">)</span>

store<span class="token punctuation">.</span><span class="token function">subscibe</span><span class="token punctuation">(</span><span class="token function">throttle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">saveState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        todos<span class="token operator">:</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>todos
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>saveSate()不能操作的太过频繁，引入lodash,控制在不能低于1s内更新localStorage
其中loadState的方法，是将state数据放在locastorage中.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">loadState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> serializedState <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>serializedState <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>serializedState<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">undefined</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">saveState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> serializedState <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">,</span> serializedState<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Ignore write errors.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>生成uuid的方法</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install node-uuid
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>import {v4} from 'node-uuid'

export const addTodo = (text) =&gt; ({
 type: 'ADD_TODO',
 id: v4()
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="wrapping-dispatch-to-log-actions"><a href="#wrapping-dispatch-to-log-actions" class="header-anchor">#</a> wrapping <code>dispatch()</code> to log actions</h3> <p>我们来手动改下一下<code>dispatch</code>函数来打印一下<code>state</code>的改变情况</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">addLoggingToDispatch</span> <span class="token operator">=</span> <span class="token parameter">store</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> rawDispatch <span class="token operator">=</span> store<span class="token punctuation">.</span>dispatch
  <span class="token keyword">return</span> <span class="token parameter">action</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c prev state'</span><span class="token punctuation">,</span> <span class="token string">'color: gray'</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c action'</span><span class="token punctuation">,</span> <span class="token string">'color: blue'</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span>
    <span class="token keyword">const</span> returnValue <span class="token operator">=</span> <span class="token function">rawDispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c next state'</span><span class="token punctuation">,</span> <span class="token string">'color: green'</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">groupEnd</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
    <span class="token keyword">return</span> returnValue
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
store<span class="token punctuation">.</span>dispatch <span class="token operator">=</span> <span class="token function">addLoggingToDispatch</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="adding-a-fake-backend-to-the-project"><a href="#adding-a-fake-backend-to-the-project" class="header-anchor">#</a> adding a fake backend to the project</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'node-uuid'</span>
<span class="token keyword">const</span> fakeDataBase <span class="token operator">=</span> <span class="token punctuation">{</span>
  todos<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token function">v4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      text<span class="token operator">:</span> <span class="token string">'hey'</span><span class="token punctuation">,</span>
      completed<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token function">v4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      text<span class="token operator">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span>
      completed<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token function">v4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      text<span class="token operator">:</span> <span class="token string">'heh'</span><span class="token punctuation">,</span>
      completed<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">delay</span> <span class="token operator">=</span> <span class="token parameter">ms</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchTodos</span> <span class="token operator">=</span> <span class="token parameter">filter</span> <span class="token operator">=&gt;</span>
  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>filter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'all'</span><span class="token operator">:</span>
        <span class="token keyword">return</span> fakeDataBase<span class="token punctuation">.</span>todos
      <span class="token keyword">case</span> <span class="token string">'active'</span><span class="token operator">:</span>
        <span class="token keyword">return</span> fakeDataBase<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>todo<span class="token punctuation">.</span>completed<span class="token punctuation">)</span>
      <span class="token keyword">case</span> <span class="token string">'completed'</span><span class="token operator">:</span>
        <span class="token keyword">return</span> fakeDataBase<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=&gt;</span> todo<span class="token punctuation">.</span>completed<span class="token punctuation">)</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Unknown filter: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filter<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h3 id="dispatching-actions-with-the-fetched-data"><a href="#dispatching-actions-with-the-fetched-data" class="header-anchor">#</a> dispatching actions with the fetched data</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentWillUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>filter <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>filter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fetchTodos</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>filter<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 开始连接action</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">receiveTodos</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><code>actions.js</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">receiveTodos</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'RECEIVE_TODOS'</span><span class="token punctuation">,</span> response
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="wrapping-dispatch-to-recongize-promise"><a href="#wrapping-dispatch-to-recongize-promise" class="header-anchor">#</a> wrapping <code>dispatch()</code> to recongize Promise</h3> <p>上面的fetchData 先请求数据，然后dispatch方法，我们可以合并为一个操作</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">receiveTodos</span> <span class="token operator">=</span> <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'RECEIVE_TODOS'</span><span class="token punctuation">,</span>
  response
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// add</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchTodos</span> <span class="token operator">=</span> <span class="token parameter">filter</span> <span class="token operator">=&gt;</span>
  api<span class="token punctuation">.</span><span class="token function">fetchTodos</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span>
    <span class="token function">receiveTodos</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>然后我们将调用<code>fetchdata</code>方法改成如下</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> fetchTodos<span class="token punctuation">,</span> filter <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token function">fetchTodos</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这时候，我们会发现网页会爆出错误:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Error: Actions must be plain objects. Use custom middleware for async actions.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>所以我们需要手动改写一下dispatch来支持Promise方法</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">addPromiseSupportToDispatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> rawDispatch <span class="token operator">=</span> store<span class="token punctuation">.</span>dispatch<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> action<span class="token punctuation">.</span>then <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> action<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rawDispatch<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">rawDispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
store<span class="token punctuation">.</span>dispatch <span class="token operator">=</span> <span class="token function">addPromiseSupportToDispatch</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="middleware-chain"><a href="#middleware-chain" class="header-anchor">#</a> middleware chain</h3> <p>我们将上面的addPromiseSupportToDispatch方法中的rawdispatch改写为next，because this is the next function in the chain.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">logger</span> <span class="token operator">=</span> <span class="token parameter">store</span> <span class="token operator">=&gt;</span> <span class="token parameter">next</span> <span class="token operator">=&gt;</span> <span class="token parameter">action</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c prev state'</span><span class="token punctuation">,</span> <span class="token string">'color: gray'</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c action'</span><span class="token punctuation">,</span> <span class="token string">'color: lightBlue'</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span>
  <span class="token keyword">const</span> returnValue <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c next state'</span><span class="token punctuation">,</span> <span class="token string">'color: green'</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">groupEnd</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
  <span class="token keyword">return</span> returnValue
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">promise</span> <span class="token operator">=</span> <span class="token parameter">store</span> <span class="token operator">=&gt;</span> <span class="token parameter">next</span> <span class="token operator">=&gt;</span> <span class="token parameter">action</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> action<span class="token punctuation">.</span>then <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> action<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

 <span class="token keyword">const</span> <span class="token function-variable function">wrapDispatchMiddlewares</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">store<span class="token punctuation">,</span> middlewares</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   middlewares<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">middleware</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     store<span class="token punctuation">.</span>dispatch <span class="token operator">=</span> <span class="token function">middleware</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>dispatch<span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">const</span> middlewares <span class="token operator">=</span> <span class="token punctuation">[</span>promise<span class="token punctuation">]</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>Node_ENV <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    middlewares<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>logger<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token function">wrapDispatchMiddlewares</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> middlewares<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="applying-redux-applymiddleware"><a href="#applying-redux-applymiddleware" class="header-anchor">#</a> applying redux applyMiddleware</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install redux-logger
npm install redux-promise
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>import { createStore, applyMiddleware } from 'redux'
import createLogger from 'redux-logger'
import promise from 'redux-promise'
import reducer from './reducers'

const middlewares = [promise]
if(process.env.NODE_ENV !== 'production') {
  middlewares.push(createLogger)
}

const store = createStore(reducer, persistedData,applyMiddleware(...middlewares))
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Redux middleware 来进行日志记录、创建崩溃报告、调用异步接口或者路由等等。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新于:</span> <span class="time">7/7/2020, 7:28:52 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/react/react_router.html" class="prev">
        React Router
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.8a6f8a64.js" defer></script><script src="/assets/js/2.842e7985.js" defer></script><script src="/assets/js/67.30c535e8.js" defer></script>
  </body>
</html>
