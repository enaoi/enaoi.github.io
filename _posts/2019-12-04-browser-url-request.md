---
title: æµè§ˆå™¨URLå¤„ç†ä»¥åŠjavascriptåŠ è½½å’Œæ‰§è¡Œæ—¶é—´çº¿
date: 2019-12-04 16:28:44
categories:
- browser
tags:
- browser
---
å½“ä½ åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥urlï¼Œæ•²å‡»å›è½¦åï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿæ–‡æ¡£è¿”å›åï¼Œæµè§ˆå™¨å¦‚ä½•æ‰§è¡Œè„šæœ¬ï¼Ÿ

## æµè§ˆå™¨å¤„ç†URLè¯·æ±‚è¿‡ç¨‹

1. åœ¨æ¥æ”¶åˆ°ç”¨æˆ·è¾“å…¥çš„ç½‘å€åï¼Œæµè§ˆå™¨ä¼šå¼€å¯ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œå¯¹ç”¨æˆ·è¾“å…¥çš„URLåœ°å€è¿›è¡Œåˆ†æåˆ¤æ–­ï¼Œå¦‚æœæ˜¯HTTPåè®®å°±æŒ‰ç…§HTTPåè®®æ–¹å¼æ¥å¤„ç†ã€‚

2. è°ƒç”¨æµè§ˆå™¨å¼•æ“ä¸­çš„å¯¹åº”æ–¹æ³•ï¼Œæ¯”å¦‚webViewä¸­çš„loadUrlæ–¹æ³•ï¼Œåˆ†æå¹¶åŠ è½½è¿™ä¸ªURLåœ°å€ã€‚

3. é€šè¿‡DNSè§£æè·å–è¯¥ç½‘ç«™åœ°å€å¯¹åº”çš„IPåœ°å€ï¼ŒæŸ¥è¯¢å®Œæˆåï¼Œè¿åŒæµè§ˆå™¨çš„Cookieã€userAgentç­‰ä¿¡æ¯å‘ç½‘ç«™ç›®çš„IPå‘å‡ºGETè¯·æ±‚ã€‚

4. è¿›è¡ŒHTTPä¼šè¯ï¼Œæµè§ˆå™¨å®¢æˆ·ç«¯å‘WebæœåŠ¡ç«¯å‘é€æŠ¥æ–‡ã€‚

5. è¿›å…¥ç½‘ç«™åå°ä¸Šçš„WebæœåŠ¡å™¨å¤„ç†è¯·æ±‚ï¼Œå¦‚ï¼šApacheã€Tomcatã€Node.jsç­‰æœåŠ¡å™¨ã€‚

6. è¿›å…¥éƒ¨ç½²å¥½çš„åç«¯åº”ç”¨ï¼Œå¦‚PHPã€Javaã€JavaScriptã€Pythonç­‰åç«¯ç¨‹åºï¼Œæ‰¾åˆ°å¯¹åº”çš„è¯·æ±‚å¤„ç†é€»è¾‘ï¼Œè¿™æœŸé—´å¯èƒ½ä¼šè¯»å–æœåŠ¡å™¨ç¼“å­˜æˆ–æŸ¥è¯¢æ•°æ®åº“ç­‰ã€‚

7. æœåŠ¡å™¨è¯·æ±‚å¹¶è¿”å›å“åº”æŠ¥æ–‡ï¼Œå¦‚æœæµè§ˆå™¨è®¿é—®è¿‡è¯¥é¡µé¢ï¼Œç¼“å­˜ä¸Šæœ‰å¯¹åº”èµ„æºï¼Œä¼šä¸æœåŠ¡å™¨æœ€åä¿®æ”¹è®°å½•å¯¹æ¯”ï¼Œä¸€è‡´åˆ™è¿”å›304ï¼Œå¦åˆ™è¿”å›200å’Œå¯¹åº”å†…å®¹ã€‚

8. æµè§ˆå™¨å¼€å§‹ä¸‹è½½HTMLæ–‡æ¡£(å“åº”æŠ¥å¤´ä¸º200æ—¶)æˆ–è€…ä»æœ¬åœ°ç¼“å­˜è¯»å–æ–‡ä»¶å†…å®¹ã€‚

9. æµè§ˆå™¨æ ¹æ®ä¸‹è½½æ¥æ”¶åˆ°çš„HTMLæ–‡ä»¶è§£æç»“æ„å»ºç«‹DOMæ–‡æ¡£æ ‘ï¼Œå¹¶æ ¹æ®HTMLä¸­æ ‡è®°è¯·æ±‚ä¸‹è½½æŒ‡å®šçš„MIMEç±»å‹æ–‡ä»¶ï¼ˆCSSã€JavaScriptæ–‡ä»¶ç­‰ï¼‰ã€‚åŒæ—¶è®¾ç½®ç¼“å­˜ç­‰å†…å®¹ã€‚

10. é¡µé¢å¼€å§‹è§£ææ¸²æŸ“DOMï¼ŒCSSæ ¹æ®è§„åˆ™è§£æå¹¶ç»“åˆDOMæ–‡æ¡£æ ‘è¿›è¡Œç½‘é¡µå†…å®¹å¸ƒå±€å’Œç»˜åˆ¶æ¸²æŸ“ï¼ŒJavaScriptæ ¹æ®DOM APIæ“ä½œDOMï¼Œå¹¶è¯»å–æµè§ˆå™¨ç¼“å­˜ã€æ‰§è¡Œäº‹ä»¶ç»‘å®šç­‰ï¼Œé¡µé¢æ•´ä¸ªå±•ç¤ºå®Œæˆã€‚

## åŒæ­¥ã€å¼‚æ­¥å’Œå»¶è¿Ÿè„šæœ¬

htmlè§£æå™¨é‡åˆ°`script`å…ƒç´ æ—¶ï¼Œé»˜è®¤å¿…é¡»å…ˆæ‰§è¡Œè„šæœ¬ï¼Œç„¶åå†æ¢å¤æ–‡æ¡£çš„è§£æå’Œæ¸²æŸ“ã€‚

è¿™å¯¹äºå†…è”è„šæœ¬æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¯¹äºsrcå¼•å…¥çš„å¤–éƒ¨æ–‡ä»¶ï¼Œè¿™æ„å‘³ç€è„šæœ¬ä¹‹åçš„æ–‡æ¡£åœ¨è¯¥è„šæœ¬ä¸‹è½½å’Œæ‰§è¡Œå‰ï¼Œä¼šé˜»å¡ é¡µé¢ UIçš„æ¸²æŸ“ã€‚

### defer å’Œ async

defer å’Œ async å±æ€§éƒ½ä¼šä½¿æµè§ˆå™¨åœ¨ä¸‹è½½è„šæœ¬æ—¶ï¼Œç»§ç»­è§£æå’Œæ¸²æŸ“æ–‡æ¡£ã€‚

- defer å±æ€§ï¼šæµè§ˆå™¨å»¶è¿Ÿæ‰§è¡Œè„šæœ¬ï¼Œç›´åˆ°æ–‡æ¡£çš„è½½å…¥å’Œè§£æå®Œæˆï¼Œå¹¶å¯ä»¥æ“ä½œã€‚ å¯ä»¥è·å–æ‰€æœ‰çš„DOMï¼Œä¿æŒé¡ºåºå®Œæˆã€‚

- asyncå±æ€§ï¼šæµè§ˆå™¨å¯ä»¥å°½å¿«æ‰§è¡Œè„šæœ¬ï¼Œè€Œä¸ç”¨åœ¨ä¸‹è½½è„šæœ¬æ—¶ï¼Œé˜»å¡æ–‡æ¡£è§£æã€‚ä¹Ÿå°±æ˜¯è¯´è„šæœ¬æ‰§è¡Œçš„æ—¶å€™DOMè¿˜æ²¡æœ‰è¢«ç¼–è¯‘ï¼Œæ‰€ä»¥æœ‰å¯èƒ½æ— æ³•è®¿é—®DOMç»“æ„ï¼Œä¸”æ˜¯ä¹±åºçš„ã€‚

#### ä¼˜å…ˆçº§

  åŒæ—¶å­˜åœ¨ defer å’Œ async ï¼š async ä¼˜å…ˆï¼Œdefer è¢«å¿½ç•¥ã€‚

#### ä½ç‰ˆæœ¬æ–¹æ¡ˆ

ä¸æ”¯æŒasyncå±æ€§çš„æµè§ˆå™¨ï¼Œå¯ä»¥åŠ¨æ€åˆ›å»ºscriptå…ƒç´ ï¼Œå¹¶æŠŠå®ƒæ’å…¥åˆ°æµè§ˆå™¨ï¼Œæ¥å®ç°å¼‚æ­¥è½½å…¥å’Œæ‰§è¡Œã€‚

```javascript
function loadasync(url){
  var head = document.getElementByTagName("head")[0];
  var s = document.createElement("script");
  s.src = url;
  head.appendChild(s);
}
```

Google Analytics å’Œ Google+ Badge éƒ½ä½¿ç”¨äº†è¿™ç§å¼‚æ­¥åŠ è½½ä»£ç ï¼Œä½†æ˜¯æ˜¯ç«‹å³æ‰§è¡Œå‡½æ•°ï¼ŒåŸºæœ¬æ¨¡å¼å¦‚ä¸‹ï¼š

 ```javascript
 (function () {
    var s = document.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    a.src = 'js/jquery.min.js';
    var x = document.getElementsByTagName('script')[0];
    x.parentNode.insertBefore(s,x);
})();
 ```

ä½†æ˜¯è¿™ç§åŠ è½½æ–¹æ³•ä¼šåœ¨åŠ è½½æ‰§è¡Œå®Œä¹‹å‰é˜»æ­¢onloadäº‹ä»¶çš„è§¦å‘ã€‚æˆ‘ä»¬å¯ä»¥åœ¨onloadæ—¶å¼‚æ­¥åŠ è½½

```javascript
(function () {
    function async_load() {
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        a.src = 'js/jquery.min.js';
        var x = document.getElementsByTagName('script')[0];
        x.parentNode.insertBefore(s,x);
    }

    if(window.attachEvent){
        window.attachEvent('onload',async_load);
    }else{
        window.addEventListener('load',async_load,false);
    }

})();
```

## JavaScriptæ‰§è¡Œæ—¶é—´çº¿

1. Webæµè§ˆå™¨åˆ›å»ºDocumentå¯¹è±¡,å¼€å§‹è§£æwebé¡µé¢ï¼Œè§£æHTML å…ƒç´ å’Œå®ƒä»¬çš„æ–‡æœ¬å†…å®¹åæ·»åŠ Element å¯¹è±¡å’Œ Text èŠ‚ç‚¹åˆ°æ–‡æ¡£ä¸­ã€‚è¿™ä¸ªé˜¶æ®µ `document.readystate = 'loading'`ã€‚

2. é‡åˆ°éasync/deferçš„åŒæ­¥è„šæœ¬æ–‡ä»¶æ—¶ï¼Œè¿™äº›è„šæœ¬ä¼š**åŒæ­¥æ‰§è¡Œ**ã€‚**å¹¶ä¸”åœ¨è„šæœ¬ä¸‹è½½å’Œæ‰§è¡Œæ—¶è§£æå™¨ä¼šæš‚åœ**ã€‚

3. é‡åˆ°`async`å±æ€§çš„è„šæœ¬æ—¶ï¼Œå¼€å§‹ä¸‹è½½ï¼Œä½†è§£æå™¨ä¸ä¼šç­‰å¾…ä¸‹è½½ï¼Œè€Œæ˜¯ç»§ç»­è§£æã€‚**asyncè„šæœ¬ä¼šåœ¨ä¸‹è½½å®Œæˆåå°½å¿«æ‰§è¡Œã€‚æ‰€æœ‰çš„å¼‚æ­¥è„šæœ¬ğŸˆ²ï¸ä½¿ç”¨document.write()æ–¹æ³•ã€‚**

4. æ–‡æ¡£è§£æå®Œæˆï¼Œ`document.readystate = 'interactive'`

5. æ‰€æœ‰`defer`å±æ€§çš„å»¶è¿Ÿè„šæœ¬ï¼Œ**æŒ‰ç…§å®ƒä»¬åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„é¡ºåºæ‰§è¡Œ**ã€‚å¼‚æ­¥è„šæœ¬ä¹Ÿå¯èƒ½ä¼šåœ¨è¿™ä¸ªæ—¶é—´æ‰§è¡Œã€‚å»¶è¿Ÿè„šæœ¬èƒ½è®¿é—®å®Œæ•´çš„æ–‡æ¡£æ ‘ï¼ŒğŸˆ²ï¸ä½¿ç”¨document.write()æ–¹æ³•

6. è§¦å‘ `DOMContentLoaded` äº‹ä»¶ã€‚ `æ ‡å¿—ç€ç¨‹åºä»åŒæ­¥è„šæœ¬æ‰§è¡Œé˜¶æ®µè¿›å…¥äº†å¼‚æ­¥äº‹ä»¶é©±åŠ¨é˜¶æ®µ`ã€‚**æ­¤æ—¶å¯èƒ½è¿˜æœ‰ä¸€æ­¥è„šæœ¬æ²¡æœ‰æ‰§è¡Œå®Œæˆã€‚**

7. å¦‚æœæœ‰jqueyçš„readyäº‹ä»¶ï¼Œæ­¤æ—¶ä¼šè§¦å‘äº†

8. æ–‡æ¡£è§£æå®Œå…¨å®Œæˆï¼Œä½†æµè§ˆå™¨è¿˜ä¼šç­‰å¾…å…¶å®ƒå†…å®¹è½½å…¥ï¼Œå¦‚ï¼šå›¾ç‰‡ã€‚**æ‰€æœ‰è¿™äº›èµ„æºåŠ è½½å®Œæˆï¼Œä¸”æ‰€æœ‰å¼‚æ­¥è„šæœ¬å®Œæˆè½½å…¥å’Œæ‰§è¡Œå,`document.readystate='complete'`ã€‚** è§¦å‘ Window å¯¹è±¡çš„ `load` äº‹ä»¶ã€‚

```javascript
window.onload = function () {
  console.log('window onload ')
}
document.addEventListener('DOMContentLoaded', function () {
  console.log('document DOMContentLoaded');
});
$(document).ready(function () {
  console.log('jquery read event')
})
// document DOMContentLoaded
// jquery read event
// window onload
```

## å¦‚ä½•è®¡ç®—æ¸²æŸ“æ—¶é—´

`window.performance` åŒ…å«äº†æµè§ˆå™¨åŠ è½½é˜¶æ®µå„ç§ä¿¡æ¯ã€‚
é¡µé¢åŠ è½½è¿‡ç¨‹ä¸­çš„å„ä¸ªæ—¶é—´ç¯é¡ºåºï¼š
![performanc timing](/images/performanc_timing.png)

```javascript
const data = {
  timeOrigin: 1577341568983.8718,
  // åªæœ‰chromeæµè§ˆå™¨æœ‰
  memory: {
    totalJSHeapSize: 19412842,
    usedJSHeapSize: 17133522,
    jsHeapSizeLimit: 2197815296
  },
  navigation: {
    // 0 æ­£å¸¸è¿›å…¥é¡µé¢
    // 1 é€šè¿‡ window.location.reload() åˆ·æ–°é¡µé¢
    // 2 é€šè¿‡æµè§ˆå™¨çš„å‰è¿›åé€€æŒ‰é’®è¿›å…¥é¡µé¢
    // 255 éä»¥ä¸Šæ–¹å¼è¿›å…¥çš„é¡µé¢
    type: 0,
    // é¡µé¢ç»è¿‡å‡ æ¬¡é‡å®šå‘è·³è½¬è€Œæ¥
    redirectCount: 0
  },
  timing: {
    // åœ¨åŒä¸€ä¸ªæµè§ˆå™¨ä¸Šä¸‹æ–‡ä¸­ï¼Œå‰ä¸€ä¸ªç½‘é¡µunloadçš„æ—¶é—´æˆ³ï¼Œå¦‚æœæ— å‰ä¸€ä¸ªç½‘é¡µçš„unloadï¼Œåˆ™ä¸fetchStartç›¸ç­‰
    navigationStart: 1577341568983,
    // ä¸å½“å‰é¡µé¢åŒåŸŸåçš„é’±ä¸€ä¸ªç½‘é¡µçš„unloadçš„æ—¶é—´æˆ³ï¼Œå…¶å®ƒéƒ½ä¸º0
    unloadEventStart: 0,
    unloadEventEnd: 0,
    // ç¬¬ä¸€ä¸ªHTTPé‡å®šå‘å‘ç”Ÿæ—¶çš„æ—¶é—´ã€‚æœ‰è·³è½¬ä¸”æ˜¯åŒåŸŸåçš„é‡å®šå‘æ‰ç®—ï¼Œå¦åˆ™å€¼ä¸º0
    redirectStart: 0,
    redirectEnd: 0,
    // æµè§ˆå™¨å‡†å¤‡å¥½ä½¿ç”¨ http è¯·æ±‚æŠ“å–æ–‡æ¡£çš„æ—¶é—´ï¼Œè¿™å‘ç”Ÿåœ¨æ£€æŸ¥æœ¬åœ°ç¼“å­˜ä¹‹å‰
    fetchStart: 1577341568993,
    // DNS åŸŸåæŸ¥è¯¢å¼€å§‹ã€‚å¦‚æœä½¿ç”¨äº†æœ¬åœ°ç¼“å­˜(å³æ—  DNS æŸ¥è¯¢)æˆ–æŒä¹…è¿æ¥ï¼Œåˆ™ä¸ fetchStart å€¼ç›¸ç­‰
    domainLookupStart: 1577341568993,
    domainLookupEnd: 1577341568993,
    // HTTP(TCP) å¼€å§‹å»ºç«‹è¿æ¥çš„æ—¶é—´ï¼Œå¦‚æœæ˜¯æŒä¹…è¿æ¥ï¼Œåˆ™ä¸ fetchStart ç›¸ç­‰
    connectStart: 1577341568993,
    // å®Œæˆä¸‰æ¬¡æ¡æ‰‹
    connectEnd: 1577341568993,
    secureConnectionStart: 0,
    // HTTP è¯·æ±‚è¯»å–çœŸå®æ–‡æ¡£å¼€å§‹æ—¶é—´ï¼ŒåŒ…æ‹¬ä»æœ¬åœ°è¯»å–ç¼“å­˜
    requestStart: 1577341568995,
    // HTTP æ¥æ”¶å“åº”å¼€å§‹çš„æ—¶é—´ï¼ŒåŒ…æ‹¬ä»æœ¬åœ°è¯»å–ç¼“å­˜
    responseStart: 1577341568996,
    responseEnd: 1577341568998,
    // å¼€å§‹è§£ææ¸²æŸ“ DOM æ ‘æ—¶é—´ï¼Œ æ­¤æ—¶ document.readyStateå˜ä¸º loading ,å¹¶æŠ›å‡º readystatechange ç›¸å…³äº‹ä»¶
    domLoading: 1577341569004,
    // å®Œæˆè§£æ DOM æ ‘, document.readyState å˜ä¸º interactive
    domInteractive: 1577341569195,
    // domCotentLoadedäº‹ä»¶æŠ›å‡ºä¹‹å‰
    domContentLoadedEventStart: 1577341569195,
    // domContentLoadedäº‹ä»¶æŠ›å‡ºä¹‹å
    domContentLoadedEventEnd: 1577341569197,
    // document.readyState çŠ¶æ€å˜ä¸º complete
    domComplete: 1577341569205,
    // load æ—¶é—´å‘é€ç»™æ–‡æ¡£ï¼Œå¦‚æœæ²¡æœ‰ç»‘å®šloadäº‹ä»¶ï¼Œå€¼ä¸º0
    loadEventStart: 1577341569205,
    // load äº‹ä»¶çš„å›è°ƒå‡½æ•°æ‰§è¡Œå®Œæ¯•
    loadEventEnd: 1577341569205
  }
};
```

å„ç±»æŒ‡æ ‡è®¡ç®—ï¼š

```javascript
times.loadPage = t.loadEventEnd - t.navigationStart
// è§£æ DOM ç»“æ„
times.domReady = t.domComplete - t.responseEnd
//ã€é‡è¦ã€‘è¯»å–é¡µé¢ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´
//ã€åŸå› ã€‘è¿™å¯ä»¥ç†è§£ä¸ºç”¨æˆ·æ‹¿åˆ°ä½ çš„èµ„æºå ç”¨çš„æ—¶é—´ï¼ŒåŠ å¼‚åœ°æœºæˆ¿äº†ä¹ˆï¼ŒåŠ CDN å¤„ç†äº†ä¹ˆï¼ŸåŠ å¸¦å®½äº†ä¹ˆï¼ŸåŠ  CPU è¿ç®—é€Ÿåº¦äº†ä¹ˆï¼Ÿ
// TTFB å³ Time To First Byte çš„æ„æ€
// ç»´åŸºç™¾ç§‘ï¼šhttps://en.wikipedia.org/wiki/Time_To_First_Byte
times.ttfb = t.responseStart - t.navigationStart;

//ã€é‡è¦ã€‘å†…å®¹åŠ è½½å®Œæˆçš„æ—¶é—´
//ã€åŸå› ã€‘é¡µé¢å†…å®¹ç»è¿‡ gzip å‹ç¼©äº†ä¹ˆï¼Œé™æ€èµ„æº css/js ç­‰å‹ç¼©äº†ä¹ˆï¼Ÿ
times.request = t.responseEnd - t.requestStart;

//ã€é‡è¦ã€‘æ‰§è¡Œ onload å›è°ƒå‡½æ•°çš„æ—¶é—´
//ã€åŸå› ã€‘æ˜¯å¦å¤ªå¤šä¸å¿…è¦çš„æ“ä½œéƒ½æ”¾åˆ° onload å›è°ƒå‡½æ•°é‡Œæ‰§è¡Œäº†ï¼Œè€ƒè™‘è¿‡å»¶è¿ŸåŠ è½½ã€æŒ‰éœ€åŠ è½½çš„ç­–ç•¥ä¹ˆï¼Ÿ
times.loadEvent = t.loadEventEnd - t.loadEventStart;

// DNS ç¼“å­˜æ—¶é—´
times.appcache = t.domainLookupStart - t.fetchStart;

// å¸è½½é¡µé¢çš„æ—¶é—´
times.unloadEvent = t.unloadEventEnd - t.unloadEventStart;

// TCP å»ºç«‹è¿æ¥å®Œæˆæ¡æ‰‹çš„æ—¶é—´
times.connect = t.connectEnd - t.connectStart;
```

:star2: points:

- urlè§£æä¸­çš„DNSåŸç†
- httpå’Œhttpsåè®®
- æµè§ˆå™¨ç¼“å­˜çš„åˆ¤æ–­å’Œæ¸…ç†
- jqueryçš„readyäº‹ä»¶ï¼Œwindowçš„loadäº‹ä»¶`DOMContentLoaded`äº‹ä»¶çš„é¡ºåº
- æµè§ˆå™¨æ¸²æŸ“å¼•æ“æœºåˆ¶
