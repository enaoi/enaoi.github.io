(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{384:function(t,s,e){"use strict";e.r(s);var n=e(25),a=Object(n.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"gzip压缩"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gzip压缩"}},[t._v("#")]),t._v(" gzip压缩")]),t._v(" "),e("p",[t._v("服务器端进行gzip压缩的优点")]),t._v(" "),e("ol",[e("li",[t._v("降低宽带成本，加快网页加载速度")]),t._v(" "),e("li",[t._v("gogle可以直接读取gizp文件来更快的检索文件")])]),t._v(" "),e("p",[t._v("gzip传输的过程")]),t._v(" "),e("ol",[e("li",[t._v("客户端请求头中的 "),e("code",[t._v("accept-encoding")]),t._v(" 属性是否包含 gzip。 当前chrome浏览器的默认值是 gzip, deflate, br")]),t._v(" "),e("li",[t._v("Web服务器接收到浏览器的HTTP请求后，检查浏览器是否支持HTTP压缩（"),e("code",[t._v("Accept-Encoding")]),t._v(" 信息）")]),t._v(" "),e("li",[t._v("Web服务器接到request后， 生成原始的Response, 其中有原始的"),e("code",[t._v("Content-Type")]),t._v("和"),e("code",[t._v("Content-Length")])]),t._v(" "),e("li",[t._v("Web服务器通过Gzip，来对Response进行编码，编码后header中有"),e("code",[t._v("Content-Type")]),t._v("和"),e("code",[t._v("Content-Length")]),t._v("(压缩后的大小)，并且增加了"),e("code",[t._v("Content-Encoding:gzip")]),t._v(". 然后把Response发送给浏览器。")]),t._v(" "),e("li",[t._v("浏览器获取后，通过response的"),e("code",[t._v("content-encoding")]),t._v("判断否压缩，然后显示响应内容。")])]),t._v(" "),e("p",[t._v("gzip的缺陷")]),t._v(" "),e("ul",[e("li",[t._v("对jepg这类文件压缩性能不够好")])]),t._v(" "),e("p",[t._v("开启gzip压缩")]),t._v(" "),e("ul",[e("li",[t._v("nodejs 原生 zlib模块 "),e("code",[t._v("zlib.createGzip()")])]),t._v(" "),e("li",[t._v("nodejs 中间件 "),e("code",[t._v("compression")]),t._v(" "),e("ul",[e("li",[t._v("基本用法："),e("code",[t._v("app.use(compression())")])]),t._v(" "),e("li",[t._v("过滤器： "),e("code",[t._v("app.use(compression({filter: shouldCompress }))")])])])])]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("shouldCompress")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'x-no-compression'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// don't compress responses with this request header")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// fallback to standard filter function")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" compression"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("ul",[e("li",[t._v("koa 中间件 compress")])]),t._v(" "),e("p",[t._v("前端webpack打包  "),e("code",[t._v("compression-webpack-plugin")])])])}),[],!1,null,null,null);s.default=a.exports}}]);