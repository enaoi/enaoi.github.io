(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{389:function(t,a,s){"use strict";s.r(a);var _=s(25),v=Object(_.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"高性能网站建设指南"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#高性能网站建设指南"}},[t._v("#")]),t._v(" 高性能网站建设指南")]),t._v(" "),s("h2",{attrs:{id:"_1-减少-http-请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-减少-http-请求"}},[t._v("#")]),t._v(" 1. 减少 HTTP 请求")]),t._v(" "),s("p",[t._v("👉"),s("strong",[s("mark",[t._v("雪碧图 CSS Sprites")])])]),t._v(" "),s("p",[t._v("将多个图片合并为一幅单独的图片，通过"),s("code",[t._v("background-position")]),t._v("来指定偏移量，显示需要的图片。")]),t._v(" "),s("ol",[s("li",[t._v("减少了请求数")]),t._v(" "),s("li",[t._v("降低了下载数")]),t._v(" "),s("li",[t._v("合并后的图片实际比分离的图片总和小，因为降低了图片自身的开销(颜色表，格式信息等等)")])]),t._v(" "),s("p",[t._v("👉"),s("strong",[s("mark",[t._v("内联图片 Inline Images")])])]),t._v(" "),s("p",[t._v("通过"),s("code",[t._v("data:URL")]),t._v("模式可以在 Web 页面中包含图片")]),t._v(" "),s("ol",[s("li",[t._v("但无需任何额外的 http 请求。")]),t._v(" "),s("li",[t._v("base64 编码会增加图片的大小，整体下载量会增加。")]),t._v(" "),s("li",[t._v("内联在页面中的，在跨越不同页面时不会被缓存。优化的方法是使用 CSS，并将内联图片作为背景。外部样式表是可以被缓存的。")])]),t._v(" "),s("p",[t._v("👉"),s("strong",[s("mark",[t._v("合并脚本和样式表")])])]),t._v(" "),s("p",[t._v("👉"),s("strong",[s("mark",[t._v("this 的指向")])])]),t._v(" "),s("h2",{attrs:{id:"_2-使用-cdn"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用-cdn"}},[t._v("#")]),t._v(" 2. 使用 CDN")]),t._v(" "),s("p",[t._v("内容发布网络(Content Delivery Networks) 是一组分布在多个不同地理位置的 Web 服务器，用于发布静态内容。")]),t._v(" "),s("h2",{attrs:{id:"_3-http-缓存：expires、catch-control"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-http-缓存：expires、catch-control"}},[t._v("#")]),t._v(" 3. HTTP 缓存：Expires、Catch-Control")]),t._v(" "),s("p",[t._v("浏览器和代理使用缓存来减少 HTTP 请求的数量，并减小 HTTP 响应的大小，使 web 页面加载的更快。HTTP1.1 引入 "),s("code",[t._v("Catch-Control")]),t._v(" 头部来克服 "),s("code",[t._v("Expires")]),t._v(" 头的限制：")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("Expires")]),t._v(" 头使用一个特定的时间，它要求服务器和客户端的时钟严格同步。")]),t._v(" "),s("li",[t._v("过期日期需要经常检察，一但时间到了，需要配置另一个新的日期。"),s("code",[t._v("Catch-control")]),t._v(" 使用 "),s("code",[t._v("max-age")]),t._v(" 指令指定组件被缓存多久。 它以秒为单位定义被请求时间过去的有效秒数。")])]),t._v(" "),s("p",[t._v("📮 "),s("strong",[s("code",[t._v("Catch-control")]),t._v("具有优先权。")])]),t._v(" "),s("p",[t._v("👉"),s("strong",[s("mark",[t._v("缓存带来的问题是：如何更新缓存文件")])])]),t._v(" "),s("blockquote",[s("p",[t._v("之前有笔记专门来说这个更新机制的问题")])]),t._v(" "),s("h2",{attrs:{id:"_4-压缩组件-gip-components"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-压缩组件-gip-components"}},[t._v("#")]),t._v(" 4. 压缩组件(Gip Components)")]),t._v(" "),s("p",[t._v("通过减小响应的 size 来减少响应时间，对速度较慢的带宽尤为明显。")]),t._v(" "),s("p",[t._v("请求头中 "),s("code",[t._v("Accept-Encoding")]),t._v(" 字段标识对压缩的支持。\n响应头中 "),s("code",[t._v("Content-Encoding")]),t._v(" 字段通知 Web 客户端\n"),s("code",[t._v("Content-Encoding:gzip")]),t._v(" 是目前最流行和有效的压缩方法。")]),t._v(" "),s("p",[t._v("服务器基于文件类型选择压缩什么，但通常受限与对其进行的配置。")]),t._v(" "),s("ol",[s("li",[t._v("很多网站压缩 HTML 文档、脚本和样式表。")]),t._v(" "),s("li",[t._v("图片和 PDF 不应该被压缩，因为它们本身已经被压缩过，再进行压缩只是浪费 CPU 资源，还可能增加大小。")])]),t._v(" "),s("p",[t._v("👉"),s("strong",[s("mark",[t._v("代理缓存问题")])])]),t._v(" "),s("p",[t._v("代理的缓存可能是来自于不支持 gzip 的浏览器，于是缓存了一份非 gzip 的文件，此时另一个支持 gzip 的浏览器请求，则会返回非 gzip 的缓存文件。反之，情况更糟糕。")]),t._v(" "),s("p",[t._v("解决： 服务器响应头中增加 "),s("code",[t._v("Vary")]),t._v("字段,来告诉代理根据一个或多个请求头来改变缓存的响应。这将使得代理缓存多个版本。\n设置"),s("code",[t._v("Vary:Accept-Encoding")]),t._v("代理会缓存 gzip 和非 gzip 的版本。")]),t._v(" "),s("p",[t._v("👉"),s("strong",[s("mark",[t._v("边缘情况")])])]),t._v(" "),s("p",[t._v("无论是客户端还是服务器发声错误(发送压缩内容到不支持它的客户端，忘记将压缩内容声明为已经进行了 gzip 压缩等)，页面都会被破坏。")]),t._v(" "),s("p",[t._v("一种安全的方式，是只为了已经证实支持压缩的浏览器提供压缩内容。被称为浏览器白名单。")]),t._v(" "),s("p",[t._v("而代理的加入，使得情况变得更加复杂。\n可以将 "),s("code",[t._v("User-Agent")]),t._v(" 作为代理的另一种评判标准加到 Vary 头部中 "),s("code",[t._v("Vary:Accept-Encoding,User-Agent")]),t._v("。\n但 User-Agent 种类繁多，基本上是破坏了代理缓存。")]),t._v(" "),s("p",[t._v("有些人采用 "),s("code",[t._v("Catch-Control: private")]),t._v(" 禁止代理缓存。")]),t._v(" "),s("h2",{attrs:{id:"_5-将样式表放在顶部"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-将样式表放在顶部"}},[t._v("#")]),t._v(" 5. 将样式表放在顶部")]),t._v(" "),s("p",[t._v("样式表放在文档底部，为避免当样式变化时重绘页面中的内容，浏览器中阻止内容逐步呈现，导致白屏。")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("样式表包含在文档中有两种方式 "),s("code",[t._v("LINK")]),t._v(" 标签和 "),s("code",[t._v("@import")]),t._v(" 规则：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("@import")]),t._v(" 规则必须放在所有其它规则之前，否则失效。")]),t._v(" "),s("li",[s("code",[t._v("@import")]),t._v(" 会导致白屏，即使放在 HEAD 标签中也是。")])]),t._v(" "),s("p",[t._v("所以最好还是使用 LINK 标签")])]),t._v(" "),s("p",[t._v("如果样式表仍在加载，构建呈现树就是一种浪费，因为在所有样式表加载并解析拆解之前无需绘制任何东西，否则，在其准备好之前显示内容会遇到无样式内容的闪烁。")]),t._v(" "),s("h2",{attrs:{id:"_6-减少脚本阻塞加载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-减少脚本阻塞加载"}},[t._v("#")]),t._v(" 6. 减少脚本阻塞加载")]),t._v(" "),s("p",[t._v("同步脚本阻塞加载。")]),t._v(" "),s("h3",{attrs:{id:"并行下载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#并行下载"}},[t._v("#")]),t._v(" 并行下载")]),t._v(" "),s("p",[t._v("浏览器并行的执行 HTTP 请求，但过多的并行请求会影响性能。")]),t._v(" "),s("h3",{attrs:{id:"脚本阻塞下载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#脚本阻塞下载"}},[t._v("#")]),t._v(" 脚本阻塞下载")]),t._v(" "),s("p",[t._v("并行下载组件的有点很明显。然而，下载脚本时并行下载实际上是被禁用的：")]),t._v(" "),s("ol",[s("li",[t._v("脚本可能使用 document.write 来修改页面内容，因此浏览器会等待，以确保页面能够恰当的布局。")]),t._v(" "),s("li",[t._v("保证脚本能够按照正确的顺序执行。")])]),t._v(" "),s("p",[t._v("现在有了更多的脚本类型 defer 和 async 带来更好的体验和优化。")]),t._v(" "),s("h2",{attrs:{id:"_7-避免-css-表达式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-避免-css-表达式"}},[t._v("#")]),t._v(" 7. 避免 CSS 表达式")]),t._v(" "),s("p",[t._v("某些浏览器的兼容问题，可能会使得开发者用"),s("code",[t._v("expression")]),t._v(" 方法调用 js 表达式来完善。")]),t._v(" "),s("p",[t._v("不仅在页面呈现和大小改变时，页面滚动，甚至是鼠标在页面上移动，CSS 表达式都会重新求值。CSS 表达式的频繁求值使得其可以工作，也导致了性能低下。")]),t._v(" "),s("p",[t._v("解决方法：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("一次性表达式\ncss 调用该函数，函数将样式设置为一个明确的值，并移除 CSS 表达式。")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("style")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    p{\n        background-color: expression(altBgcolor(this));\n    }\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("style")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text/javascript"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}},[s("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("altBgcolor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("elem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    elem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("backgroundColor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHours")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#F08A00"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#B88AFF"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("事件处理器\n监听 window.onresize 事件，通过脚本设置 CSS 属性。")])])]),t._v(" "),s("h2",{attrs:{id:"_8-使用外部脚本和样式表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-使用外部脚本和样式表"}},[t._v("#")]),t._v(" 8. 使用外部脚本和样式表")]),t._v(" "),s("p",[t._v("虽然首次加载时，内联脚本和文件会因为减少了 HTTP 请求而获得较快的加载速度。\n但外部文件的优势有：")]),t._v(" "),s("ol",[s("li",[t._v("可以被浏览器缓存，一般变化的 HTML 不会设置为缓存对象。")]),t._v(" "),s("li",[t._v("页面中相同的脚本和样式表，可以被复用。")])]),t._v(" "),s("h2",{attrs:{id:"_9-减少-dns-查找-domain-name-system"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-减少-dns-查找-domain-name-system"}},[t._v("#")]),t._v(" 9. 减少 DNS 查找(Domain Name System)")]),t._v(" "),s("p",[t._v("Internet 通过 IP 地址来查找服务器，但由于 IP 地址很难记忆，通常使用包含主机名的 URL 来取代它。 但浏览器发送的请求，最终还是要解析 IP 地址，这就是 Domain Name System 所处的角色。")]),t._v(" "),s("p",[t._v("浏览器查找一个给定主机名的 IP 地址需要 20-120ms。 HTTP 请求的响应时间依赖于 DNS 解析器。")]),t._v(" "),s("p",[t._v("DNS 可以被缓存起来以提高性能：\n很多浏览器拥有自己的缓存，和操作系统的缓存相分离。浏览器中其缓存中保留了 DNS 记录，则直接返回地址。浏览器丢弃或没有记录时，才会询问操作系统，然后操作系统通过其缓存来响应这个请求，或者将请求发送给一个远程服务器，这时就会发生潜在的速度降低。\n但 IP 地址变化以及缓存会消耗内存，因此，应该周期性的清除缓存中的 DNS 记录，并配置检测清除的频率。")]),t._v(" "),s("p",[t._v("影响 DNS 缓存的因素：")]),t._v(" "),s("ul",[s("li",[t._v("服务器可以表明缓存的有效时间。查找返回的 DNS 记录包含一个存活时间(Time-to-live,TTL)值。该值告诉客户端可以对该记录缓存多久。")]),t._v(" "),s("li",[t._v("操作系统通常会考虑 TTL 值，但浏览器通常忽略该值，并设置它自己的时间设置。")]),t._v(" "),s("li",[t._v("HTTP 系统中的 Keep-Alive 特性可以同时覆盖 TTL 和浏览器时间限制。")]),t._v(" "),s("li",[t._v("浏览器对 DNS 记录的数量也有限制，而不管缓存记录的时间。用户短时间内访问了多个不同域名的网站，较早的 DNS 记录会被丢弃。")]),t._v(" "),s("li",[t._v("但浏览器丢弃了记录，操作系统可能依然保留着该记录。")])]),t._v(" "),s("p",[t._v("通过 Keep-Alive 和较少的域名来减少 DNS 查找")]),t._v(" "),s("h2",{attrs:{id:"_10-精简-javascript-minify-javascript"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-精简-javascript-minify-javascript"}},[t._v("#")]),t._v(" 10. 精简 JavaScript(Minify JavaScript)")]),t._v(" "),s("ol",[s("li",[t._v("精简脚本：移除不必要的字符以减小其大小。注释、空格、换行、制表符等都将被移除。")]),t._v(" "),s("li",[t._v("混淆脚本和压缩等")]),t._v(" "),s("li",[t._v("精简 CSS： 合并相同类，移除不使用的类等")])]),t._v(" "),s("h2",{attrs:{id:"_11-避免重定向"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11-避免重定向"}},[t._v("#")]),t._v(" 11. 避免重定向")]),t._v(" "),s("p",[t._v("重定向是将用户从一个 URL 重新路由到另一个 URL。重定向有很多种，301 和 302 是最常见的。\n当 Web 服务器向浏览器返回一个重定向时，响应中会拥有一个范围在 3**的状态码：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("304 Not Modified")]),t._v(" 并不是真的重定向，而是响应 GET 请求的缓存判断。")]),t._v(" "),s("li",[s("code",[t._v("301/302")]),t._v(" 浏览器会自动将用户带到 Location 字段所给出的 URL")])]),t._v(" "),s("p",[t._v("缺少结尾的斜线，发生重定向是最为常见和浪费的问题。")]),t._v(" "),s("h2",{attrs:{id:"_12-移除重复脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-移除重复脚本"}},[t._v("#")]),t._v(" 12. 移除重复脚本")]),t._v(" "),s("h2",{attrs:{id:"_13-配置-etag"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_13-配置-etag"}},[t._v("#")]),t._v(" 13. 配置 ETag")]),t._v(" "),s("p",[t._v("多个服务器可能反而导致缓存存在问题，需要服务端进行配置。")]),t._v(" "),s("h2",{attrs:{id:"_14-ajax-可缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_14-ajax-可缓存"}},[t._v("#")]),t._v(" 14. ajax 可缓存")]),t._v(" "),s("p",[t._v("优化 ajax 请求也可以使用上面的 4、9、10、11、13 规则。具体看 ajax 设置缓存的规则。")])])}),[],!1,null,null,null);a.default=v.exports}}]);